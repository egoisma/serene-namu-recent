<!DOCTYPE html>
<html>
    <head>
        <title>serene-namu-recent</title>
        <meta http-equiv="Content-Type" content="text/html"; charset="UTF-8">
        <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js" type="text/javascript" charset="utf-8"></script>
        <style>
            h1 {
                color : #00a495;
                font-size : 46px;
            }
            button {
                background: #00a495;
                color: #fff;
                border: none;
                outline: none;
                font-size: 22px;
                width: 398px;
                height: 50px;
            }
        </style>
    </head>
    <body>
        <div align=center >
            <h1>serene-namu-recent</h1>
            <h3>기동 상태 : <span id="state_getdata">On</span></h3>
            <div id="svg"></div>
            <br />
            <button onclick="start()">시작</button>
            <button onclick="stop()">중지</button>
            <br /><br />
            <br /><br />
            <!-- Copyright 2020. Kihun Jang. All rights reserved. -->
        </div>
        <script type="text/javascript">
            
            let paperWidth = 800;
            let paperHeight = 400;
            var paper = Raphael(document.getElementById('svg'), paperWidth, paperHeight);
            paper.rect(0, 0, paperWidth, paperHeight);

            //var audio = new Audio("./sound/waterdrop.mp3");
            //audio.volume=1;

            var timer_getData = setInterval(getData, 1000);
            
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            function getData() {
                $.ajax({
                    type : 'GET',
                    url : 'http://localhost:5000/data',
                    data : {},
                    success : function(data) {
                        
                        var wiki = data["wiki"];
                        for(var i=0; i<wiki.length; i++) {
                            var fontSize = (Math.abs(wiki[i]["size"])>50 ? 50 : Math.abs(wiki[i]["size"]/5.0)+18.0);

                            var x = Math.random()*(paperWidth-fontSize*(wiki[i]["name"].length+1))+fontSize*(wiki[i]["name"].length+1)/2;
                            var y = Math.random()*(paperHeight-fontSize)+fontSize/2;
                            var color = wiki[i]["size"]>=0 ? 'green' : 'red';

                            var text = paper.text(x, y, wiki[i]["name"]);

                            //audio.play();

                            text.attr({
                                'fill' : color,
                                'font-size' : fontSize,
                                'font-family' : '돋움'
                            });
                            sleep(100);
                        }
                        setTimeout(function() {
                            text.remove();
                        }, 7000)
                    },
                    error : function() {
                        alert("Get Failed");
                        clearInterval(timer_getData);
                    }
                })
            }
            function start() {
                clearInterval(timer_getData);
                timer_getData = setInterval(getData, 1000);
                document.getElementById("state_getdata").innerHTML = "On";
            }
            function stop() {
                clearInterval(timer_getData);
                document.getElementById("state_getdata").innerHTML = "Off";
            }
            
            
        </script>
    </body>
    
</html>